<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grade Converter — IB Survival Hub</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .converter-wrap{margin-top:18px}
    .converter-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:900px){.converter-grid{grid-template-columns:1fr}}
    .big-out{font-size:38px;font-weight:800;letter-spacing:-.02em;margin:0}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.08);opacity:.85}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
    th{opacity:.7;font-weight:600}
    .muted2{opacity:.65}
    .warn{padding:12px;border-radius:12px;background:rgba(241,196,15,.12);border:1px solid rgba(255,255,255,.08);margin-top:12px}
  </style>
</head>
<body>
  <header class="topbar">
  <div class="topbar-inner">

    <a class="brand" href="index.html">
      <span class="brand-badge"></span>
      <span>IB Survival Hub</span>
    </a>

    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="subjects.html">Subjects</a>
      <a href="planner.html">Planner</a>
      <a href="converter.html" class="active">Converter</a>
      <a href="boundaries.html">Boundaries</a>
      <a href="quiz.html">Study Quiz</a>
      <a href="resources.html">Resources</a>
    </nav>

  </div>
</header>

  <main class="container">
    <section class="hero">
      <h1>Ontario IB Grade Converter</h1>
      <p class="muted">Convert raw mark → Ontario percentage using your school’s conversion ranges.</p>

      <div class="warn">
        <b>Important:</b> Different schools/boards use different conversion tables. This tool uses a starter template.
        You can replace the ranges with your school’s official sheet.
      </div>

      <div class="converter-wrap">
        <div class="converter-grid">
          <div class="panel">
            <h2>Inputs</h2>

            <label for="subject">Subject</label>
            <select id="subject">
              <option value="hl_english">HL English</option>
              <option value="sl_math">SL Math</option>
              <option value="hl_econ">HL Economics</option>
              <option value="custom">Custom (edit ranges)</option>
            </select>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
              <div>
                <label for="raw">Raw mark (0–100)</label>
                <input id="raw" type="number" min="0" max="100" placeholder="e.g., 74" />
              </div>
              <div>
                <label for="level">IB Level (1–7)</label>
                <select id="level">
                  <option value="auto">Auto (from raw)</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                  <option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option>
                </select>
              </div>
            </div>

            <button class="btn" style="margin-top:14px" onclick="convert()">Convert</button>

            <div class="small-note" style="margin-top:10px">
              Tip: If your teacher gave a table, use <b>Custom</b> and paste the ranges once.
            </div>
          </div>

          <div class="panel">
            <h2>Converted Mark</h2>
            <p class="muted2" id="modeTag"><span class="pill">Template mode</span></p>
            <p class="big-out" id="out">—</p>
            <p class="muted" id="out2">Enter a raw mark, then convert.</p>
          </div>
        </div>

        <div class="panel" style="margin-top:16px">
          <h2>Conversion Ranges</h2>
          <p class="muted2" id="tableTitle">Showing template ranges for selected subject.</p>
          <div id="tableWrap"></div>

          <div id="customEditor" style="display:none;margin-top:14px">
            <h3 style="margin:10px 0">Custom ranges editor</h3>
            <p class="muted2">Format: Level, rawMin, rawMax, percentMin, percentMax</p>
            <textarea id="customText" style="width:100%;min-height:180px;border-radius:12px;padding:12px;background:#0f1b34;border:1px solid rgba(255,255,255,.08);color:white"></textarea>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
              <button class="btn" onclick="saveCustom()">Save custom ranges</button>
              <button class="btn" onclick="loadCustom()">Load saved custom</button>
              <button class="btn" onclick="resetCustom()">Reset to template</button>
            </div>
          </div>

          <div class="small-note" style="margin-top:12px">
            External reference: you can link tools like ibconverter.com in Resources, but don’t copy their tables unless licensed.
          </div>
        </div>
      </div>

      <div class="footer">Built for CAS: tech + service + user-focused tool.</div>
    </section>
  </main>

<script>
/*
  Starter templates (PLACEHOLDERS).
  Replace with your school’s official table using Custom editor.
*/
const templates = {
  hl_english: [
    {lvl:1, raw:[0,19], pct:[0,49]},
    {lvl:2, raw:[20,35], pct:[50,60]},
    {lvl:3, raw:[36,45], pct:[61,71]},
    {lvl:4, raw:[46,59], pct:[72,83]},
    {lvl:5, raw:[60,72], pct:[84,92]},
    {lvl:6, raw:[73,85], pct:[93,96]},
    {lvl:7, raw:[86,100], pct:[97,100]},
  ],
  sl_math: [
    {lvl:1, raw:[0,15], pct:[0,49]},
    {lvl:2, raw:[16,28], pct:[50,60]},
    {lvl:3, raw:[29,40], pct:[61,71]},
    {lvl:4, raw:[41,55], pct:[72,83]},
    {lvl:5, raw:[56,70], pct:[84,92]},
    {lvl:6, raw:[71,85], pct:[93,96]},
    {lvl:7, raw:[86,100], pct:[97,100]},
  ],
  hl_econ: [
    {lvl:1, raw:[0,18], pct:[0,49]},
    {lvl:2, raw:[19,32], pct:[50,60]},
    {lvl:3, raw:[33,45], pct:[61,71]},
    {lvl:4, raw:[46,58], pct:[72,83]},
    {lvl:5, raw:[59,72], pct:[84,92]},
    {lvl:6, raw:[73,85], pct:[93,96]},
    {lvl:7, raw:[86,100], pct:[97,100]},
  ],
};

function getRanges(){
  const subj = document.getElementById("subject").value;
  if(subj === "custom"){
    const saved = localStorage.getItem("ib_custom_ranges");
    if(saved){
      try { return JSON.parse(saved); } catch(e){ return templates.hl_english; }
    }
    return templates.hl_english;
  }
  return templates[subj] || templates.hl_english;
}

function renderTable(){
  const subj = document.getElementById("subject").value;
  const ranges = getRanges();

  document.getElementById("customEditor").style.display = (subj==="custom") ? "block" : "none";
  document.getElementById("modeTag").innerHTML = (subj==="custom")
    ? `<span class="pill">Custom mode</span>`
    : `<span class="pill">Template mode</span>`;

  const rows = ranges.map(r => `
    <tr>
      <td><b>Level ${r.lvl}</b></td>
      <td>${r.raw[0]}–${r.raw[1]}</td>
      <td>${r.pct[0]}–${r.pct[1]}</td>
    </tr>
  `).join("");

  document.getElementById("tableWrap").innerHTML = `
    <table>
      <thead>
        <tr><th>Level</th><th>Raw</th><th>Converted</th></tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

function convert(){
  const rawVal = Number(document.getElementById("raw").value);
  if(Number.isNaN(rawVal)){
    document.getElementById("out").innerText = "—";
    document.getElementById("out2").innerText = "Enter a raw mark first.";
    return;
  }
  const raw = clamp(rawVal, 0, 100);

  const ranges = getRanges();
  const manualLevel = document.getElementById("level").value;

  let match = null;

  if(manualLevel !== "auto"){
    const lvl = Number(manualLevel);
    match = ranges.find(r => r.lvl === lvl);
    if(!match){
      document.getElementById("out").innerText = "—";
      document.getElementById("out2").innerText = "No range found for that level.";
      return;
    }
  } else {
    match = ranges.find(r => raw >= r.raw[0] && raw <= r.raw[1]);
  }

  if(!match){
    document.getElementById("out").innerText = "—";
    document.getElementById("out2").innerText = "Raw mark didn’t match any range (check your table).";
    return;
  }

  // Map raw within the band to a converted percent within the band (linear interpolation)
  const [r0,r1] = match.raw;
  const [p0,p1] = match.pct;
  const t = (r1 === r0) ? 0 : (raw - r0) / (r1 - r0);
  const pct = Math.round(p0 + t * (p1 - p0));

  document.getElementById("out").innerText = pct + "%";
  document.getElementById("out2").innerText = `IB Level ${match.lvl} band (raw ${r0}–${r1} → ${p0}–${p1
